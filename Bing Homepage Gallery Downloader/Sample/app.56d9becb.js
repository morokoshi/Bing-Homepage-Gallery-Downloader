/*! Bing Homepage Gallery | http://bing.com/gallery | 2016-01-11 */
!function(){var a={controls:{},utils:{}};!function(){function b(a,b,c){var d=a+":"+b;s.events=c,s.tl(this,"o",d),s.events=""}function c(a,c,d){$(a).on("click",function(){b("Home",c,d)})}function d(a,c,d,e){$(a).on("click",c,function(){b("Home",d,e)})}function e(a,c,d){$("#detailOuter").on("click",a,function(){b("Lightbox",c,d)})}$(document).ready(function(){d("#grid",".tile","Lightbox","event3"),c("#logo","Logo","event4"),d("#categories",".choice","Category","event5"),d("#tags",".choice","Tag","event6"),d("#holidays",".choice","Holiday","event7"),d("#regions",".choice","Places","event8"),$("#countries .choices").on("change",function(){b("Home","Country","event9")}),d("#colors",".choice","Color","event10"),c(".expandButton","More Expander","event11"),c(".privacyLegal","Privacy & Legal","event12"),c("#footerMore","More Footer","event13"),c("#homeWpDownload","WP Pack Download","event14"),e("#detailOverlay","Close Lighbox","event15"),e(".detailClose","Close Lightbox","event15"),e(".detailInfoLink","SERP Link","event19"),e(".detailRelatedLink","SERP MM","event20"),e(".detailDownloadLink","Download Image","event21"),e(".detailOneDriveLink","Save to OneDrive","event25"),e(".detailPrev","Forward/Back Button","event22"),e(".detailNext","Forward/Back Button","event22"),c("#controlRewards","Rewards","event23")}),a.analytics={reportEvent:b,tweet:function(a){b(a,"Twitter Share","event16")},fbShare:function(a){b(a,"Facebook Share","event17")},emailShare:function(a){b(a,"Email Share","event18")},scrollLoadImages:function(){b("Home","Scroll","event26")}}}(),function(){var a=window.navigator.platform||"",b="Win32"===a||"Win64"===a,c=!!window.navigator.userAgent.match(/Windows Phone/i),d="arm"===window.navigator.cpuClass;!b||c||d||$(document).ready(function(){$("#controlTop").addClass("wpDownload")})}(),function(){function b(a){var b,c,d,e=[];for(b=0,c=a.length;c>b;b++)d=a[b],(d||0===d||d===!1)&&e.push(d);return 0===e.length?null:1===e.length?e[0]:e}function c(a){var c,d,e,f=[];for(c=0,d=a.length;d>c;c++)e=a[c],e&&e.indexOf(",")>=0&&(e=b(e.split(","))),f.push(e);return f}a.data={},a.data.initBrowseData=function(b){var d=a.table=new PxFacetSearch.Table;d.addColumn(new PxFacetSearch.Column("imageId",b.imageIds)),d.addColumn(new PxFacetSearch.Column("shortName",b.shortNames)),d.addColumn(new PxFacetSearch.Column("imageName",b.imageNames)),d.addColumn(new PxFacetSearch.Column("date",b.dates)),d.addColumn(new PxFacetSearch.CategoryColumn("category",c(b.categories))),d.addColumn(new PxFacetSearch.CategoryColumn("tag",b.tags)),d.addColumn(new PxFacetSearch.CategoryColumn("holiday",b.holidays)),d.addColumn(new PxFacetSearch.CategoryColumn("region",c(b.regions))),d.addColumn(new PxFacetSearch.CategoryColumn("country",b.countries)),d.addColumn(new PxFacetSearch.CategoryColumn("color",b.colors)),a.view=new a.controls.GalleryView(d),a.router.onHashChange()},a.data.getDetails=function(b,c){var d="home/imagedetails/"+b+"?z=0";if(a.offline){var e=!0;d=e?"devonly/AngelOak.json":"devonly/Denali.json"}$.ajax({dataType:"json",url:d,success:c})}}(),function(){function b(b,c){var d=a.table.getColumn("date"),e=d.values[b],f=e%100,g=(e-f)%1e4/100,h=(e-100*g-f)%1e9/1e4;return c[g-1]+" "+f+", "+h}a.dates={};var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["January","February","March","April","May","June","July","August","September","October","November","December"];a.dates.getShortDateString=function(a){return b(a,c)},a.dates.getLongDateString=function(a){return b(a,d)}}(),function(){function b(b){var c=$(".detail").last();b?c.data("aspect",b):b=c.data("aspect")||o;var d=$("#detailInner"),e=(c.find(".detailImage"),c.find(".detailSpacer")),f=$(window),g=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(a.isSmallScreen=l>=g,d.toggleClass("smallScreen",a.isSmallScreen),d.toggleClass("largeScreen",!a.isSmallScreen),a.isSmallScreen){var h=g*(1/b);e.css({height:h}),c.css({width:"",height:"",left:"",top:""}),$(".detailText").css("top","")}else{var i=Math.min(g-(q+2*n),p),j=i*(1/b),k=i+q,m=j,r=(g-k)/2,s=(f.height()-m)/2;c.css({width:k,height:m,left:r,top:s}),$(".detailText").css("top",$(".detailTitle").height()+80)}}function c(b,c){var d=a.view.getPrevNextInfo(b),e=c.find(".detailPrev");null!==d.prev?e.data("imageIndex",d.prev):e.hide();var f=c.find(".detailNext");null!==d.next?f.data("imageIndex",d.next):f.hide()}function d(a){return a&&0===a.indexOf("http://")?a.substring(5):a&&0===a.indexOf("https://")?a.substring(6):a}function e(c,e,f){$(".detail").each(function(){var g=$(this);if(g.data("imageId")===e){g.find(".detailTitle").text(f.title),g.find(".detailImage").attr("alt",f.title);var h=d(f.infoLink);g.find(".detailInfoLink").attr("href",h).show();var i=d(f.similarLink);if(g.find(".detailRelatedLink").attr("href",i).show(),f.wallpaper){var j=a.images.getWallpaper(c),k=a.images.getDownloadFilename(c);g.find(".detailDownloadLink").attr("href",j).attr("download",k).show(),g.find(".detailOneDriveLink").show()}var l=a.dates.getLongDateString(c);g.find(".detailDate").text(l);var m,n,o=[];for(m=0,n=f.text.length;n>m;m++)o.push($("<p/>").text(f.text[m]));g.find(".detailText").html(o),setTimeout(function(){b(),g.find(".detailPanel").fadeTo(500,1)},400)}})}function f(b,c,d){$("#detailOuter").fadeIn(200);var e=function(){c.find(".detailInfoLink").focus()};if(b.length>0){var f=d===a.TransitionDirections.NEXT?"-=100":"+=100",g=d===a.TransitionDirections.NEXT?"+=100":"-=100";a.isDetailTransitioning=!0;var h=parseInt(c.css("left"),10),i=parseInt(c.css("right"),10);c.css({left:h+100*d,right:i+-100*d,opacity:0}),c.animate({left:f,right:g,opacity:1},{duration:400,easing:"easeInOutQuad",complete:e}),b.animate({left:f,right:g,opacity:0},{duration:400,easing:"easeInOutQuad",complete:function(){b.remove(),a.isDetailTransitioning=!1}})}else $("#detailInner").delay(200).fadeIn(400,e)}function g(b,c){if(!a.isDetailTransitioning){var d=$(b.currentTarget),e=d.data("imageIndex");(e||0===e)&&a.showDetail(e,c)}}function h(b){g(b,a.TransitionDirections.NEXT)}function i(b){g(b,a.TransitionDirections.PREVIOUS)}function j(b){var c=$(b.currentTarget);if(!c.attr("href")){b.preventDefault();var d=c.parents(".detail"),e=d.data("imageId"),f=function(a,b){d.find(".detailOneDriveTooltip").html(a).addClass("show").delay(4e3).queue(function(){var a=$(this).removeClass("show").dequeue();b&&b(a)})};a.onedrive.saveWallpaper(e).then(function(a){var b=["Wallpaper saved to OneDrive!","<br>",$('<a target="_blank" />').text("View the Wallpaper in OneDrive").attr("href",a)];d.find(".detailOneDriveLink").attr("href",a),f(b)},function(){var a="Oops! We could not save the wallpaper to OneDrive. Please try again.";f(a,function(a){a.html(m)})})}}a.TransitionDirections={NONE:0,PREVIOUS:-1,NEXT:1};var k='<div class="detail"><div class="detailImageContainer"><img class="detailSpacer" src="//az615200.vo.msecnd.net/site/images/spacer.2b887621.png"><img class="detailImage" src="<%=imageUrl%>" oncontextmenu="return false;"><div class="detailPrev"><span>Previous</span></div><div class="detailNext"><span>Next</span></div></div><div class="detailPanel"><div class="detailContent"><h3 class="detailTitle"></h3><h4 class="detailDate"></h4><div class="detailText"></div></div><div class="detailLinks"><a class="detailInfoLink kbSelect" tabindex="1" href="" target="_blank">Learn more</a><br><a class="detailRelatedLink kbSelect" tabindex="1" href="" target="_blank">Related images</a><div class="detailSocial"><div class="detailSocialButton detailFacebook kbSelect" tabindex="1">Share on Facebook</div><div class="detailSocialButton detailTwitter kbSelect" tabindex="1">Share on Twitter</div><div class="detailSocialButton detailLink kbSelect" tabindex="1">Share Link</div><div class="detailDownloadOptions"><a class="detailOneDriveLink" href="" target="_blank">Download to OneDrive</a><span class="detailOneDriveTooltip"></span><a class="detailDownloadLink" href="" target="_blank">Download as Wallpaper</a><span class="detailDownloadLinkTooltip"><strong>Download this image.</strong> Use of this image is restricted to wallpaper only.</span></div></div></div></div><div class="detailClose kbSelect" tabindex="1">Close</div></div>',l=1200;a.isSmallScreen=!1,a.isDetailTransitioning=!1;var m="<strong>Save to OneDrive.</strong> Use of this image is restricted to wallpaper only.",n=30,o=1366/768,p=1366,q=320;a.showDetail=function(d,g){a.router.navigateToImage(d);var h=$(".detail"),i=a.utils.template(k,{imageUrl:a.images.getFullSize(d)}),j=a.images.indexToId(d),l=$(i).data("imageId",j).append($(".footer").first().clone()).appendTo("#detailInner");l.find(".detailOneDriveTooltip").html(m),a.data.getDetails(j,function(a){e(d,j,a)}),c(d,l);var n=a.images.getAspectRatio(d);b(n),f(h,l,g);var o=l.children(".detailImage");o.one("load",function(){$(this).show(),l.find(".detailSpacer").hide()}).each(function(){this.complete&&$(this).load()}),$("html, body").addClass("noScroll")},a.hideDetail=function(){$("#detailOuter").addClass("hiding").fadeOut(200,function(){$("#detailInner").empty(),$("#detailOuter").removeClass("hiding")}),$("html, body").removeClass("noScroll");var b=$(window).scrollTop();a.router.navigateToHome(),$("html, body").scrollTop(b)},$(window).resize(function(){b()}),$(document).ready(function(){$("#detailOverlay").click(a.hideDetail),$(window).keydown(function(b){var c=b.which;switch(c){case a.utils.Keys.RIGHT_ARROW:$(".detailNext").trigger("click");break;case a.utils.Keys.LEFT_ARROW:$(".detailPrev").trigger("click");break;case a.utils.Keys.ESCAPE:$(".detailClose").trigger("click")}}),$("#detailInner").on("click",".detailClose",a.hideDetail).on("click",".detailNext",h).on("click",".detailPrev",i).on("click",".detailOneDriveLink",j)})}(),function(){$(document).ready(function(){$("#contriesSelect").change(function(){$(this).blur()})})}(),function(){function b(b,c){var e=a.table.getColumn("imageName"),f=e.values[b];return d(f+"_"+c+".jpg")}function c(b){var c=a.table.getColumn("date"),d=c.values[b];return e>=d}function d(a){var b,c,d,e=f.length,g=0;for(b=0,c=a.length;c>b;b++)g=(g<<5)-g+a.charCodeAt(b),g&=g;return d=Math.abs(g)%e,f[d]+a}var e=20120524;a.images={},a.images.getThumbnail=function(a){return b(a,"320x180")},a.images.getMediumSize=function(a){return b(a,"640x360")},a.images.getFullSize=function(a){var d=c(a)?"958x512":"1366x768";return b(a,d)},a.images.getWallpaper=function(a){return b(a,"1920x1200")},a.images.getDownloadFilename=function(b){var c=a.table.getColumn("shortName"),d=c.values[b];return d+".jpg"},a.images.getAspectRatio=function(a){return c(a)?958/512:1366/768},a.images.indexToId=function(b){var c=a.table.getColumn("imageId"),d=c.values[b];return d};var f=["//az608707.vo.msecnd.net/files/","//az619519.vo.msecnd.net/files/","//az619822.vo.msecnd.net/files/"]}(),function(){a.layouts={};var b=[{columnCount:2,tileCount:8,layout:["A A","A A",". .",". .","B B","B B",". ."]},{columnCount:3,tileCount:15,layout:[". A A",". A A",". . .","B B .","B B .",". . .",". . ."]},{columnCount:4,tileCount:40,layout:[". . A A",". . A A",". . . .","B B . .","B B . .",". . . .",". A A .",". A A .",". . . .",". . . .","B B . .","B B . .",". . . ."]},{columnCount:5,tileCount:53,layout:[". . A A .",". . A A .",". . . . .","B B . . .","B B . . .",". . . . .",". . . A A",". . . A A",". . . . .",". B B . .",". B B . .",". . . . .",". . . . ."]},{columnCount:6,tileCount:54,layout:[". . . A A .",". . . A A .",". . . . . .","B B . . . .","B B . . . .",". . . . A A",". . . . A A",". B B . . .",". B B . . .",". . . . . .",". . . . . ."]},{columnCount:7,tileCount:65,layout:[". . . . A A .",". . . . A A .",". . . . . . .","B B . . . . .","B B . . . . .",". . . . . A A",". . . . . A A",". . . . . . .",". B B . . . .",". B B . . . .",". . . . . . ."]},{columnCount:8,tileCount:110,layout:["B B . . . A A A","B B . . . A A A",". . . . . A A A","B B . . . . . .","B B . . . . . .",". . . . . . . .",". . . . . A A .",". . . . . A A .",". B B B . . . .",". B B B . . C C",". B B B . . C C",". . . . . . . .","C C . . A A . .","C C . . A A . .",". . . . . . D D",". B B . . . D D",". B B . . . . .",". . . . . . . ."]}];a.layouts.layoutEngine={get:function(a,c){for(var d=null,e=Math.ceil(c/a),f=0;f<b.length;f++)b[f].columnCount===a&&(d=b[f]);if(d){for(var g=[],h=0;c>h;){h+=d.tileCount;for(var i=0;i<d.layout.length;i++)g.push(d.layout[i])}var j=Tiles.Template.fromJSON(g);return j}var k,l,m=[];for(l=0;e>l;l++)for(k=0;a>k;k++)m.push(new Tiles.Rectangle(k,l,1,1));return new Tiles.Template(m,a,e)}}}(),function(){$(document).ready(function(){var a=768,b=$("#mobileLogo"),c=$("#content"),d=$("#gridOverlay"),e=$("#controlPanel"),f=$("#mobileClose"),g=e.width(),h=!1,i=function(){h||(h=!0,e.css({left:0}),c.css({left:g,right:-1*g}),b.css({left:300,opacity:0}),d.fadeIn(400))},j=function(){h&&(h=!1,e.css({left:""}),c.css({left:"",right:""}),b.css({left:"",opacity:""}),d.fadeOut(400))},k=function(){h=!0,e.css({left:"",right:""}),c.css({left:"",right:""}),d.hide(),b.css({left:0,opacity:1})};b.click(function(){h?j():i()}),f.click(j),d.click(j),$(window).resize(function(){$(window).width()>a&&k()})})}(),function(){function b(){var a=$.Deferred();return WL.fileDialog({mode:"save"}).then(function(b){var c=b.data.folders[0].id;a.resolve(c)},function(b){a.reject("Error getting folder info: "+b.error.message)}),a}var c;switch(window.location.host){case"bing.dev":c={clientId:"000000004411C9ED",saveApi:"http://localhost:51230/api/SaveToOneDrive",redirectUri:"onedrive-callback.html"};break;case"bingarchive-test.azurewebsites.net":c={clientId:"0000000040123A77",saveApi:"https://bingarchive-test.azurewebsites.net/api/SaveToOneDrive",redirectUri:"https://bingarchive-test.azurewebsites.net/onedrive-callback.html"};break;default:c={clientId:"000000004C11FA54",saveApi:"https://www.bing.com/gallery/api/SaveToOneDrive",redirectUri:"https://www.bing.com/gallery/onedrive-callback.html"}}WL.init({client_id:c.clientId,redirect_uri:c.redirectUri}),a.onedrive={},a.onedrive.saveWallpaper=function(a){return b().then(function(b){var d=WL.getSession()||{},e=c.saveApi+"?accessToken="+encodeURIComponent(d.access_token)+"&folderId="+encodeURIComponent(b)+"&imageId="+encodeURIComponent(a);return $.ajax({url:e,type:"GET",dataType:"jsonp"})})}}(),Date.now=Date.now||function(){return+new Date},window.console||(window.console={log:$.noop}),function(){a.router={};var b="#images/",c="#",d=c;a.router.onHashChange=function(){if(a.table){var e=window.location.hash||"#";if(e!==d){if(0===e.indexOf(b)){var f=e.substr(b.length)||"",g=a.table.getColumn("shortName"),h=g.values.indexOf(f);if(h>=0)return d=e,void a.showDetail(h)}if(e!==c)return void a.router.navigateToHome();a.hideDetail(),d=c}}},a.router.navigateToImage=function(c){var e=a.table.getColumn("shortName"),f=e.values[c];d=window.location.hash=b+f},a.router.navigateToHome=function(){window.location.hash=c},$(window).on("hashchange",a.router.onHashChange)}(),function(){a.ScrollDirection={UP:-1,NONE:0,DOWN:1},a.PinPositions={UNDEFINED:-1,NONE:0,TOP:1,BOTTOM:2};var b=a.PinPositions.UNDEFINED,c=$(window),d=$("#controlPanel"),e=($("body"),null),f=(a.ScrollDirection.NONE,function(e,f){if(b!==e){switch(f=f||0,e){case a.PinPositions.NONE:d.css({position:"absolute",top:Math.max(0,f)}),$("body").css("min-height",null);break;case a.PinPositions.BOTTOM:d.css({position:"fixed",top:c.height()-d.height()}),$("body").css("min-height",d.height());break;case a.PinPositions.TOP:d.css({position:"fixed",top:0}),$("body").css("min-height",d.height())}b=e}}),g=function(){var e=parseInt(d.css("top"),10);switch(b){case a.PinPositions.UNDEFINED:case a.PinPositions.TOP:return 0;case a.PinPositions.BOTTOM:return e;case a.PinPositions.NONE:return e-c.scrollTop()}},h=function(){var c=$(window),g=$(document).height()-c.height(),h=Math.min(Math.max(0,c.scrollTop()),g),i=e>h?a.ScrollDirection.UP:a.ScrollDirection.DOWN,j=c.height(),k=d.height();if(null===e&&(i=a.ScrollDirection.NONE),e=h,j>k)return void f(a.PinPositions.TOP);if(i===a.ScrollDirection.NONE)f(a.PinPositions.NONE,h);else if(i===a.ScrollDirection.DOWN)if(b===a.PinPositions.TOP)f(a.PinPositions.NONE,h);else{var l=k-(h+j)+parseInt(d.css("top"),10);0>=l&&f(a.PinPositions.BOTTOM)}else if(i===a.ScrollDirection.UP)if(b===a.PinPositions.BOTTOM){var m=h+(c.height()-d.height());f(a.PinPositions.NONE,m)}else if(b===a.PinPositions.NONE){var n=h-parseInt(d.css("top"),10);0>=n&&f(a.PinPositions.TOP)}};a.controls.getEffectiveScrollOffset=g,c.scroll(h)}(),function(){a.social={};var b="http://www.bing.com/gallery/",c="MC10XA",d="MC10XB",e="MC10X7",f="MC10X9",g="MP10XC",h={title:"Bing Homepage Gallery",message:"Check out the Bing homepage gallery, featuring many of the amazing photos from the past 5 years.",url:b},i=function(a){var b=550,c=300,d=screen.width/2-b/2,e=screen.height/3-c/2,f="http://www.facebook.com/sharer.php?s=100&p[title]="+encodeURIComponent(a.title)+"&p[summary]="+encodeURIComponent(a.message)+"&p[url]="+encodeURIComponent(a.url);window.open(f,"facebook","height="+c+",width="+b+",left="+d+",top="+e+",resizable=1")},j=function(a){var b=550,c=300,d=screen.width/2-b/2,e=screen.height/3-c/2,f="http://twitter.com/share?url=/&text="+encodeURIComponent(a.message)+"&count=none";window.open(f,"tweet","height="+c+",width="+b+",left="+d+",top="+e+",resizable=1")},k=function(a){var b="mailto:?subject="+a.title+"&body="+encodeURIComponent(a.message);window.location.href=b},l=function(b,c){var d=b;return d=a.utils.updateQueryStringParameter(d,"FORM",c),d=a.utils.updateQueryStringParameter(d,"OCID",c)};$(document).ready(function(){$("#controlFacebook").click(function(){i({title:h.title,url:l(b,c),message:h.message}),a.analytics.fbShare("Home")}),$("#controlTwitter").click(function(){var b="http://binged.it/1mKSrqg";j({title:h.title,url:b,message:"Check out the #Bing homepage gallery, featuring many of the amazing photos from the past 5 years. Explore now: "+b}),a.analytics.tweet("Home")}),$("#controlLink").click(function(){k({title:h.title,url:l(b,g),message:"Check out the new Bing homepage image gallery. You can explore many of the breathtaking photos from our homepage over the past 5 years. "+l(b,e)}),a.analytics.emailShare("Home")}),$("#detailInner").on("click",".detailFacebook",function(){i({title:h.title,url:l(window.location.href,d),message:"Check out this Bing homepage photo. Now, with the Bing Homepage Gallery, you can explore many of the awesome photos that have been featured on Bing over the past 5 years."}),a.analytics.fbShare("Lightbox")}).on("click",".detailTwitter",function(){j({title:h.title,url:l(window.location.href,f),message:"Check out this #Bing homepage photo. Explore more photos from Bing over the last 5 years here: "+l(window.location.href,f)}),a.analytics.tweet("Lightbox")}).on("click",".detailLink",function(){k({title:h.title,url:l(b,g),message:"Check out this Bing homepage photo. To see more, explore the Bing homepage gallery, featuring many of the awesome photos from the Bing homepage over the past 5 years. "+l(window.location.href,e)}),a.analytics.emailShare("Lightbox")})})}(),function(){function b(a,b,c){var d=new RegExp("([?|&])"+b+"=.*?(&|#|$)","i");if(a.match(d))return a.replace(d,"$1"+b+"="+c+"$2");var e="",f=-1!==a.indexOf("?")?"&":"?";return-1!==a.indexOf("#")&&(e=a.replace(/.*#/,"#"),a=a.replace(/#.*/,"")),a+f+b+"="+c+e}var c=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)};c&&!d&&a.apply(e,f),clearTimeout(d),d=setTimeout(g,b)}},d={},e=function(a,b){var c=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');} return p.join('');"):d[a]=d[a]||e(document.getElementById(a).innerHTML);return b?c(b):c},f=function(a){return a.replace(/[^a-z0-9]/g,function(a){var b=a.charCodeAt(0);return 32===b?"-":b>=65&&90>=b?""+a.toLowerCase():("000"+b.toString(16)).slice(-4)})},g={LEFT_ARROW:37,RIGHT_ARROW:39,DOWN_ARROW:40,UP_ARROW:38,SPACE:32,ENTER:13,ESCAPE:27};a.utils.debounce=c,a.utils.template=e,a.utils.toCssClass=f,a.utils.updateQueryStringParameter=b,a.utils.Keys=g}(),function(){function b(a,b){this.selector=a,this.$el=b,this.$choices=this.$el.find(".choices"),this.$clearButton=this.$el.find(".clearButton").on("click",$.proxy(this.clearSelections,this)),this.choiceData=this.selector.getChoices(),this.selectionCount=this.choiceData.length,this.renderChoices()}b.prototype.updateData=function(){this.choiceData=this.selector.getChoices(),this.renderChoices()},b.prototype.updateClearButton=function(){var a=this.selectionCount===this.choiceData.length;this.$clearButton.toggleClass("show",!a)},b.prototype.toggleChoice=function(a){if(this.selectionCount===this.choiceData.length)this.selector.select([a]),this.selectionCount=1;else{var b=this.selector.getChoice(a);b&&(1===this.selectionCount&&b.selected?(this.selector.reset(),this.selectionCount=this.choiceData.length):(this.selector.toggle(a),this.selectionCount+=b.selected?-1:1))}this.updateClearButton()},b.prototype.clearSelections=function(){this.selector.reset(),this.selectionCount=this.choiceData.length,this.renderChoices()},a.controls.SelectorUI=b}(),function(){function b(a,b){this.choiceElements={Red:b.find(".red"),Orange:b.find(".orange"),Yellow:b.find(".yellow"),Green:b.find(".green"),Blue:b.find(".blue"),Purple:b.find(".purple"),Pink:b.find(".pink"),Brown:b.find(".brown"),White:b.find(".white"),Black:b.find(".black"),Multi:b.find(".multi")},b.delegate(".choice","click",$.proxy(this.choiceClick,this)),c.call(this,a,b)}var c=a.controls.SelectorUI;b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.prototype.expandButtonClick=function(){this.showAll=!this.showAll,this.$expandButton.text(this.showAll?"Less":"More"),this.$expandButton.toggleClass("expanded",this.showAll),this.$choices.toggleClass("showAll",this.showAll)},b.prototype.renderChoices=function(){this.updateClearButton();var a,b,c,d,e,f=this.selectionCount===this.choiceData.length;for(a=0,b=this.choiceData.length;b>a;a++){if(c=this.choiceData[a],!c.value)return;d=!f&&c.selected,e=this.choiceElements[c.value],e&&e.toggleClass("selected",d)}},b.prototype.choiceClick=function(a){var b=$(a.currentTarget),c=($(a.target),b.data("color"));b.toggleClass("selected"),this.toggleChoice(c)},a.controls.ColorSelector=b}(),function(){function b(a,b){b.addClass("checkbox").delegate(".choice","click",$.proxy(this.choiceClick,this)),this.$expandButton=b.find(".expandButton").on("click",$.proxy(this.expandButtonClick,this)),this.$noChoicesMsg=b.find(".noChoicesMsg"),c.call(this,a,b),this.showAll=!1}var c=a.controls.SelectorUI,d=7;b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.prototype.expandButtonClick=function(){this.showAll=!this.showAll,this.$expandButton.text(this.showAll?"Less":"More"),this.$expandButton.toggleClass("expanded",this.showAll),this.$choices.toggleClass("showAll",this.showAll)},b.prototype.renderChoices=function(){this.updateClearButton();var a,b,c,e,f,g=[],h=this.selectionCount===this.choiceData.length;for(a=0,b=this.choiceData.length;b>a;a++)c=this.choiceData[a],c.value&&(e=!h&&c.selected,f=this.renderChoice(c.value,e,c.count),f&&g.push(f));this.$choices.html(g),this.$noChoicesMsg.toggle(0===g.length),this.$expandButton.toggle(g.length>=d)},b.prototype.renderChoice=function(a,b,c){if(0===c&&!b)return null;var d=$('<li class="choice kbSelect" />').attr("tabIndex",2).append($('<div class="box"/>')).append($('<div class="mark"/>')).append($('<div class="label"/>').text(a));return b&&d.addClass("selected"),d},b.prototype.choiceClick=function(a){var b=$(a.currentTarget),c=($(a.target),b.text());b.toggleClass("selected"),this.toggleChoice(c)},a.controls.CheckboxSelector=b}(),function(){function b(a,b){b.addClass("dropdown"),c.call(this,a,b),this.$choices.on("change",$.proxy(this.selectionChanged,this))}var c=a.controls.SelectorUI;b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.prototype.renderChoices=function(){this.updateClearButton();var a,b,c,d,e,f=[],g=this.selectionCount===this.choiceData.length;for(f.push(this.renderChoice("Any",g===!0,1)),a=0,b=this.choiceData.length;b>a;a++){if(c=this.choiceData[a],!c.value)return;d=!g&&c.selected,e=this.renderChoice(c.value,d,c.count),e&&f.push(e)}this.$choices.html(f)},b.prototype.renderChoice=function(a,b,c){if(0===c&&!b)return null;var d=$("<option/>").attr("value",a).text(a);return b&&d.attr("selected","selected"),d},b.prototype.selectionChanged=function(){var a=this.$choices.val();a&&"Any"!==a?(this.selector.select([a]),this.selectionCount=1):this.clearSelections(),this.updateClearButton()},a.controls.DropdownSelector=b}(),function(){function b(b){PxFacetSearch.View.call(this,b),this.grid=new a.controls.GalleryGrid(document.getElementById("grid")),this.pageSize=30,this.visibleCount=this.pageSize;var d=a.utils.debounce($.proxy(this.resize,this),200);$(window).resize(d);var e=this.getSelector("country");e.choiceSortCompare=e.compareChoicesByValue;var f=this.getSelector("category");f.choiceSortCompare=function(a,b){return"Popular"===a.value?-1:"Popular"===b.value?1:f.compareChoicesByCount(a,b)},this.selectionControls=[new a.controls.CheckboxSelector(this.getSelector("category"),$("#categories")),new a.controls.CheckboxSelector(this.getSelector("tag"),$("#tags")),new a.controls.CheckboxSelector(this.getSelector("holiday"),$("#holidays")),new a.controls.CheckboxSelector(this.getSelector("region"),$("#regions")),new a.controls.DropdownSelector(e,$("#countries")),new a.controls.ColorSelector(this.getSelector("color"),$("#colors"))],this.$scrollUpMsg=$("#scrollUpMsg"),this.$window=$(window).on("scroll",$.proxy(this.onScroll,this)),this.minScrollUpdateDelay=500,this.lastScrollUpdate=0,this.scrollUpdateHeight=300,this.query.onUpdate(c.bind(this)),this.render()}function c(b){var c,d,e;for(c=0,d=this.selectionControls.length;d>c;c++)e=this.selectionControls[c],e.selector.name!==b&&e.updateData();var f=-1*a.controls.getEffectiveScrollOffset();$("html,body").scrollTop(f),this.visibleCount=this.pageSize,this.render()}b.prototype=Object.create(PxFacetSearch.View.prototype),b.prototype.constructor=b,b.prototype.resize=function(){this.grid.resize(),this.grid.redraw(!0,$.proxy(this.postRedraw,this))},b.prototype.render=function(){var a=this.query.matchIds,b=Math.min(a.length,this.visibleCount),c=a.slice(0,b);this.grid.updateTiles(c),this.grid.redraw(!0,$.proxy(this.postRedraw,this))},b.prototype.postRedraw=function(){var a,b,c,d=this.grid.tiles,e=this.$window.height();d.length>0?(a=d[d.length-1],c=a.top+a.height,c<this.$window.scrollTop()?(this.$scrollUpMsg.show(),this.scrollMessageShown=Date.now()):this.$scrollUpMsg.hide(),b=Math.ceil(c+$("#siteFooter").height()),this.grid.$el.css("min-height",b),a.top<e&&this.addMoreTiles()):this.grid.$el.css("min-height",null)},b.prototype.getPrevNextInfo=function(a){var b={prev:null,next:null},c=this.query.matchIds,d=c.indexOf(a);return d>0&&(b.prev=c[d-1]),d<c.length-1&&(b.next=c[d+1]),b},b.prototype.onScroll=function(){var b=Date.now();b>this.scrollMessageShown+100&&this.$scrollUpMsg.hide();var c=this.query.matchIds;if(!(this.visibleCount>=c.length)){var d=this.$window.scrollTop(),e=this.$window.height(),f=$(document).height(),g=d+e>=f-this.scrollUpdateHeight;if(g){if(b<this.lastScrollUpdate+this.minScrollUpdateDelay){var h=d+e>=f;return void(h&&this.$window.scrollTop(d-1))}this.addMoreTiles(),this.lastScrollUpdate=b,a.analytics.scrollLoadImages()}}},b.prototype.addMoreTiles=function(){var a=this.visibleCount;this.visibleCount=Math.min(this.query.matchIds.length,this.visibleCount+this.pageSize),this.visibleCount>a&&this.render()},a.controls.GalleryView=b}(),function(){function b(b){Tiles.Tile.call(this,b);var d=parseInt(b,10);this.imageIndex=d,this.$el.addClass("tile kbSelect").attr("tabindex",3).data("tileId",d),this.$bg=$('<img class="tileBg" oncontextmenu="return false;" />').hide().appendTo(this.$el),this.thumbSize=c.NONE;var e=a.dates.getShortDateString(d);$('<div class="tileDate" />').text(e).appendTo(this.$el)}var c={NONE:"none",LOW:"low",MEDIUM:"med"};b.prototype=Object.create(Tiles.Tile.prototype),b.prototype.constructor=b,b.prototype.resize=function(b,d,e,f,g){var h;b.width>1?this.thumbSize!==c.MEDIUM&&(h=a.images.getMediumSize(this.imageIndex),this.$bg.attr("src",h).show(),this.thumbSize=c.MEDIUM):this.thumbSize===c.NONE&&(h=a.images.getThumbnail(this.imageIndex),this.$bg.attr("src",h).show(),this.thumbSize=c.LOW),Tiles.Tile.prototype.resize.call(this,b,d,e,f,g)},b.compareById=function(a,b){return a.id<b.id?-1:a.id>b.id?1:0},a.controls.GalleryTile=b}(),function(){function b(b){Tiles.Grid.call(this,b),this.cellPadding=8,this.cellAspectRatio=320/180,this.cellWidthMin=260,this.templateFactory=a.layouts.layoutEngine,this.cellWidthMin=240,this.appendDelay=0,this.appendDelayIncrement=20,this.$el.on("click",".tile",function(b){var c=$(b.currentTarget),d=c.data("tileId");a.showDetail(d)})}b.prototype=Object.create(Tiles.Grid.prototype),b.prototype.constructor=b,b.prototype.createTile=function(b){var c=new a.controls.GalleryTile(b);return c},b.prototype.redraw=function(a,b){this.appendDelay=0,Tiles.Grid.prototype.redraw.call(this,a,b)},b.prototype.getAppendDelay=function(){return this.appendDelay+=this.appendDelayIncrement,this.appendDelay},a.controls.GalleryGrid=b}(),function(){$(document).on("keyup",".kbSelect",function(b){(b.which===a.utils.Keys.SPACE||b.which===a.utils.Keys.ENTER)&&($(b.currentTarget).trigger("click"),b.preventDefault())})}(),function(){function b(){return window.BingGallery&&window.BingGallery.browseData?void a.data.initBrowseData(window.BingGallery.browseData):void setTimeout(b,20)}window.BingGallery&&window.BingGallery.upgrade||(a.offline=!1,a.offline&&$.getScript("/devonly/browsedata.js"),$(document).ready(b))}()}();